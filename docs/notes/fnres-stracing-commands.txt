
--------------------  Setup  --------------------
- Add CUnit: git rm --cached ext/cunit; rm -rf ext; git submodule add --force https://gitlab.com/cunity/cunit.git ext/cunit




--------------------  stracing  --------------------
Compile: rm -rf build && mkdir build && (cd build && cmake -DCMAKE_BUILD_TYPE=Debug -DWITH_SYSCALL_TRACING=ON -DLINUX_SRC_DIR=/usr/src/linux-5.4.0 -DWITH_FILENAME_RESOLUTION=OFF -DENABLE_OUTPUT=LOGFILE -DWITH_MPI_IO=OFF -DENABLE_REMOTE_CONTROL=OFF .. && cmake --build .)


--------------------  fnres  --------------------
- Compile: rm -rf build && mkdir build && (cd build && cmake -DCMAKE_BUILD_TYPE=Debug -DWITH_FILENAME_RESOLUTION=ON -DENABLE_OUTPUT=LOGFILE -DWITH_MPI_IO=OFF -DENABLE_REMOTE_CONTROL=OFF .. && cmake --build .)
                                                                                                                             ^
                                                                                                           LOGFILE, INFLUXDB, LOGFILE_AND_INFLUXDB

- Validate logs / influx:
    - Cleanup LOGFILE's: find build/test/ -type f -name "*.log" -delete

    - Launch Influx: (cd ../Grafana && docker-compose up -d)
    - Setup Influx-CLI:
        influx config create --config-name local_influx-fspj \
            --host-url http://localhost:8086 \
            --org hse \
            --token OXBWllU1poZotgyBlLlo2XQ_u4AYGYKQmdxvJJeotKRyvdn5mwjEhCXyOjyldpMmNt_9YY4k3CKf5Eh1bN0Ng==
    - Query InfluxDB using CLI:
        influx query --active-config local_influx-fspj 'from(bucket: "hsebucket")|> range(start: -1d)|> filter(fn: (r) => r._measurement == "libiotrace")|> drop(columns: ["_start", "_stop", "_measurement", "thread", "_time"])'' | grep traced_filename


- Run test:
    All: make -C build test ARGS="-R '^test_'"

    Specific: ./build/test/cunit/test_fctevent

    ---------------------------------------
        flags: - IOTRACE_FNRES_MAX_FILENAMES=100
               - IOTRACE_DATABASE_IP=127.0.0.1 IOTRACE_DATABASE_PORT=8086 IOTRACE_INFLUX_ORGANIZATION=hse IOTRACE_INFLUX_BUCKET=hsebucket IOTRACE_INFLUX_TOKEN=OXBWllU1poZotgyBlLlo2XQ_u4AYGYKQmdxvJJeotKRyvdn5mwjEhCXyOjyldpMmNt_9YY4k3CK-f5Eh1bN0Ng==
               - IOTRACE_WHITELIST=./whitelist

- Create whitelist (for MPI-tests):
cd build/test && cat<<EOF>./whitelist
MPI_File_open
MPI_File_seek
MPI_File_read
MPI_File_write
MPI_File_close
EOF



    --- Working ---
    - POSIX -
        (cd build/test && IOTRACE_LOG_NAME=open_var_args_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./open_var_args; code ../../test/open_var_args.c open_var_args_shared_test1_iotrace.log)

        (cd build/test && IOTRACE_LOG_NAME=mmap_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./mmap_io; code ../../test/mmap_io.c mmap_shared_test1_iotrace.log)

        (cd build/test && IOTRACE_LOG_NAME=read_byte_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./read_byte_shared ; code ../../test/read_byte.c read_byte_shared_test1_iotrace.log)
        (cd build/test && IOTRACE_LOG_NAME=read_byte_static_test1 ./read_byte_static ; code ../../test/read_byte.c read_byte_static_test1_iotrace.log)

        (cd build/test && IOTRACE_LOG_NAME=read_stream_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./read_stream_shared ; code ../../test/read_stream.c read_stream_shared_test1_iotrace.log)
        (cd build/test && IOTRACE_LOG_NAME=read_stream_static_test1 ./read_stream_static ; code ../../test/read_stream.c read_stream_static_test1_iotrace.log)

        (cd build/test && IOTRACE_LOG_NAME=read_byte_and_stream_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./read_byte_and_stream_shared ; code ../../test/read_byte_and_stream.c read_byte_and_stream_shared_test1_iotrace.log)
        (cd build/test && IOTRACE_LOG_NAME=read_byte_and_stream_static_test1 ./read_byte_and_stream_static ; code ../../test/read_byte_and_stream.c read_byte_and_stream_static_test1_iotrace.log)

        TODO: ASK -> ??? fprintf is replaced w/ fwrite ???
        (cd build/test && IOTRACE_LOG_NAME=write_stream_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./write_stream_shared ; code ../../test/write_stream.c write_stream_shared_test1_iotrace.log)
        (cd build/test && IOTRACE_LOG_NAME=write_stream_static_test1 ./write_stream_static ; code ../../test/write_stream.c write_stream_static_test1_iotrace.log)

    - POSIX + OpenMP (i.e., multi-threaded) -
        (cd build/test && IOTRACE_LOG_NAME=OpenMP_read_stream_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so OMP_NUM_THREADS=2 ./OpenMP_read_stream_shared ; code ../../test/OpenMP_read_stream.c OpenMP_read_stream_shared_test1_iotrace.log)

    - MPI -
        (cd build/test && mpirun -np 4 -x IOTRACE_LOG_NAME=MPI_read_test1 -x LD_PRELOAD=../src/libiotrace_shared.so ./MPI_read ; code ../../test/MPI_read.c MPI_read_test1_iotrace.log)
        (cd build/test && mpirun -np 4 -x IOTRACE_LOG_NAME=MPI_read_test2 -x LD_PRELOAD=../src/libiotrace_shared.so ./MPI_parallel_IO_single ; code ../../test/MPI_parallel_IO_single.c MPI_read_test2_iotrace.log)
        (cd build/test && mpirun -np 4 -x IOTRACE_LOG_NAME=MPI_read_test3 -x LD_PRELOAD=../src/libiotrace_shared.so ./MPI_parallel_read ; code ../../test/MPI_parallel_read.c MPI_read_test3_iotrace.log)
        (cd build/test && mpirun -np 4 -x IOTRACE_LOG_NAME=MPI_parallel_iread -x LD_PRELOAD=../src/libiotrace_shared.so ./MPI_parallel_iread ; code ../../test/MPI_parallel_iread.c MPI_parallel_iread_iotrace.log)
        (cd build/test && mpirun -np 4 -x IOTRACE_LOG_NAME=MPI_immediate_test -x LD_PRELOAD=../src/libiotrace_shared.so ./MPI_immediate_test ; code ../../test/MPI_immediate_test.c MPI_immediate_test_iotrace.log)


    --- Broken tests (e.g., failed assertions) ---
    - POSIX -
        (cd build/test && IOTRACE_LOG_NAME=send_recv_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./send_recv_shared ; code ../../test/send_recv.c send_recv_shared_test1_iotrace.log)
        (cd build/test && IOTRACE_LOG_NAME=send_recv_static_test1 ./send_recv_static ; code ../../test/send_recv.c send_recv_static_test1_iotrace.log)

    - MPI -
            # Invalid absolute path ...
        (cd build/test && rm mpi_file_io.txt && mpirun -np 4 -x IOTRACE_LOG_NAME=mpi_file_io_test1 -x IOTRACE_DATABASE_IP=127.0.0.1 -x IOTRACE_DATABASE_PORT=8086 -x IOTRACE_INFLUX_ORGANIZATION=hse -x IOTRACE_INFLUX_BUCKET=hsebucket -x IOTRACE_INFLUX_TOKEN=OXBWllU1poZotgyBlLlo2XQ_u4AYGYKQmdxvJJeotKRyvdn5mwjEhCXyOjyldpMmNt_9YY4k3CK-f5Eh1bN0Ng== -x IOTRACE_WHITELIST=./whitelist -x LD_PRELOAD=../src/libiotrace_shared.so mpi_file_io 10 ; code ../../test/mpi_file_io.c mpi_file_io_test1_iotrace.log)


    --- Irrelevant ---
    - POSIX -
        (cd build/test && IOTRACE_LOG_NAME=clone_test1 LD_PRELOAD=../src/libiotrace_shared.so ./clone_shared ; code ../../test/clone.c clone_test1_iotrace.log)
        (cd build/test && IOTRACE_LOG_NAME=clone_static_test1 ./clone_static ; code ../../test/clone.c clone_test1_iotrace.log)


    --- Unsupported ---
    - POSIX AIO -
        (cd build/test && IOTRACE_LOG_NAME=read_async_byte_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./read_async_byte_shared ; code ../../test/read_async_byte.c read_async_byte_shared_test1.log)
        (cd build/test && IOTRACE_LOG_NAME=read_async_byte_static_test1 ./read_async_byte_static ; code ../../test/read_async_byte.c read_async_byte_static_test1.log)



    --- Unknown ---
    - POSIX:
        (cd build/test && IOTRACE_LOG_NAME=pipe_ipc_shared_test1 LD_PRELOAD=../src/libiotrace_shared.so ./pipe_ipc; code ../../test/pipe_ipc.c pipe_ipc_shared_test1_iotrace.log)

    - MPI -
        MPI + MP
        (cd build/test && rm -f mpi_file_io.txt && mpirun -np 4 -x OMP_NUM_THREADS=2 -x IOTRACE_LOG_NAME=mpi_file_io_test1 -x IOTRACE_DATABASE_IP=127.0.0.1 -x IOTRACE_DATABASE_PORT=8086 -x IOTRACE_INFLUX_ORGANIZATION=hse -x IOTRACE_INFLUX_BUCKET=hsebucket -x IOTRACE_INFLUX_TOKEN=OXBWllU1poZotgyBlLlo2XQ_u4AYGYKQmdxvJJeotKRyvdn5mwjEhCXyOjyldpMmNt_9YY4k3CK-f5Eh1bN0Ng== -x IOTRACE_WHITELIST=./whitelist -x LD_PRELOAD=../src/libiotrace_shared.so mpi_file_io 10 ; code ../../test/mpi_file_io.c mpi_file_io_test1_iotrace.log)
